# โปรแกรมดึงข้อมูลคุณภาพอากาศในประเทศไทย

โปรแกรมนี้ใช้สำหรับดึงข้อมูลคุณภาพอากาศในประเทศไทย โดยมีการทำงาน 2 รูปแบบ คือ
1. ดึงข้อมูลจากเว็บไซต์ AQI.in ผ่านการ Scraping
2. ดึงข้อมูลผ่าน WAQI API

## ความต้องการของระบบ

- Python 3.6 หรือใหม่กว่า
- ไลบรารีที่จำเป็น:
  ```bash
  pip install -r requirements.txt
  ```

## วิธีที่ 1: ดึงข้อมูลจากเว็บไซต์ (Web Scraping)

ไฟล์ `aqi_scraper.py` จะดึงข้อมูลคุณภาพอากาศจากเว็บไซต์ https://www.aqi.in/dashboard/thailand โดยตรง

### การทำงาน
1. ดึงข้อมูล HTML จากเว็บไซต์
2. แยกข้อมูลคุณภาพอากาศจากหน้าเว็บ ประกอบด้วย:
   - AQI (ดัชนีคุณภาพอากาศ)
   - PM2.5 (ฝุ่นละอองขนาดเล็ก)
   - PM10 (ฝุ่นละอองขนาดใหญ่)
   - O3 (โอโซน)
3. คำนวณค่าเฉลี่ยของประเทศไทย
4. บันทึกข้อมูลลงในไฟล์ JSON

### วิธีใช้งาน
```bash
cd tasks/air_quality
python aqi_scraper.py
```

### ข้อดี
- ไม่จำเป็นต้องใช้ API key
- สามารถดึงข้อมูลได้โดยตรงจากเว็บไซต์
- ไม่มีข้อจำกัดในการเรียกใช้งาน

### ข้อเสีย
- หากโครงสร้างเว็บไซต์เปลี่ยน อาจทำให้โปรแกรมทำงานไม่ถูกต้อง
- อาจมีข้อจำกัดในการดึงข้อมูลหากเว็บไซต์มีการป้องกันการ scraping

## วิธีที่ 2: ดึงข้อมูลผ่าน API

ไฟล์ `aqi_api.py` จะดึงข้อมูลคุณภาพอากาศผ่าน World Air Quality Index (WAQI) API

### การทำงาน
1. เชื่อมต่อกับ WAQI API
2. ดึงข้อมูลจากเมืองหลักในประเทศไทย ได้แก่:
   - กรุงเทพฯ, เชียงใหม่, ภูเก็ต, พัทยา
   - ขอนแก่น, นครราชสีมา, หาดใหญ่
   - อุดรธานี, ระยอง, สมุทรปราการ
3. แยกข้อมูลสำคัญ เช่น:
   - AQI (ดัชนีคุณภาพอากาศ)
   - PM2.5 (ฝุ่นละอองขนาดเล็ก)
   - PM10 (ฝุ่นละอองขนาดใหญ่)
   - O3 (โอโซน)
   - ข้อมูลเพิ่มเติมเช่น อุณหภูมิ ความชื้น CO, NO2, SO2
4. คำนวณค่าเฉลี่ยของประเทศไทย
5. บันทึกข้อมูลลงในไฟล์ JSON

### การเตรียมการก่อนใช้งาน
1. โปรแกรมสามารถใช้งานได้ทันทีด้วย demo API key
2. สำหรับการใช้งานจริง ควรลงทะเบียนที่ [WAQI API](https://aqicn.org/data-platform/token/) เพื่อขอรับ API key
3. แก้ไขไฟล์ `aqi_api.py` โดยใส่ API key ของคุณในบรรทัด:
   ```python
   api_client = AQIAPIClient(api_key="YOUR_API_KEY_HERE")
   ```

### วิธีใช้งาน
```bash
cd tasks/air_quality
python aqi_api.py
```

### ข้อดี
- ข้อมูลมีความน่าเชื่อถือและเป็นทางการ
- มีข้อมูลเพิ่มเติมที่ละเอียดกว่า (อุณหภูมิ, ความชื้น, พิกัด)
- โอกาสเกิดความผิดพลาดน้อยกว่า
- มีการแปลงค่า AQI เป็นคำอธิบายภาษาไทย

### ข้อเสีย
- จำเป็นต้องมี API key สำหรับการใช้งานเต็มรูปแบบ
- มีข้อจำกัดในการเรียกใช้งาน API ตามแผนที่ลงทะเบียน

## ผลลัพธ์

ทั้งสองวิธีจะสร้างโฟลเดอร์ `output` และบันทึกไฟล์ JSON ที่มีข้อมูลคุณภาพอากาศดังนี้:

1. `air_quality_data.json` สำหรับวิธี Web Scraping
2. `air_quality_api_data.json` สำหรับวิธี API

### โครงสร้างข้อมูล JSON
```json
{
  "timestamp": "2024-01-15T10:30:00.123456",
  "country": "Thailand",
  "data_source": "aqi.in หรือ WAQI API",
  "total_stations": 5,
  "average_AQI": 85.2,
  "average_PM2.5": 42.1,
  "average_PM10": 65.3,
  "average_O3": 28.7,
  "stations_data": [
    {
      "city": "Bangkok",
      "station_name": "Bangkok",
      "AQI": 89,
      "PM2.5": 45.2,
      "PM10": 68.1,
      "O3": 31.5,
      "timestamp": "2024-01-15T10:00:00+07:00"
    }
  ]
}
```

## การติดตั้งและใช้งาน

1. **ติดตั้ง dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

2. **รันโปรแกรม Web Scraping:**
   ```bash
   python aqi_scraper.py
   ```

3. **รันโปรแกรม API:**
   ```bash
   python aqi_api.py
   ```

## หมายเหตุ

- โปรแกรมนี้ทำงานบนพื้นฐานของข้อมูลที่เผยแพร่โดยสาธารณะ
- ควรตรวจสอบเงื่อนไขการใช้งาน API หรือเว็บไซต์ที่ดึงข้อมูลเพื่อให้เป็นไปตามข้อกำหนด
- ข้อมูลที่ได้รับอาจมีความแตกต่างระหว่างแหล่งข้อมูลต่างๆ
- สำหรับการใช้งานในระบบ production ควรเพิ่มการจัดการ error และ retry mechanism

## การแก้ไขปัญหา

### ปัญหาที่อาจพบ
1. **Connection Error:** ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต
2. **API Rate Limit:** รอสักครู่แล้วลองใหม่ หรือใช้ API key ของตัวเอง
3. **No Data Found:** เว็บไซต์อาจเปลี่ยนโครงสร้าง หรือไม่มีข้อมูลในขณะนั้น

### การปรับแต่ง
- สามารถเพิ่มเมืองอื่นๆ ในไฟล์ `aqi_api.py` ที่ตัวแปร `thai_cities`
- สามารถปรับเปลี่ยน timeout และ retry logic ตามความต้องการ 